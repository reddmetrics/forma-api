# What is forma-api?

This project provides a RESTful API to FORMA data using JSON representations. It rides on [Noir](https://github.com/ibdknox/noir), a framework for writing web applications in Clojure.

# Overview  

The FORMA data surfaced by this API is generated by the [forma-clj](https://github.com/sritchie/forma-clj) project. We have a [rough API spec here](https://github.com/whizbangsystems/forma-api/wiki/API-Specification).
  
# Getting Started

To get started, you'll need to install a few tools, but it's painless.

* forma-api (this project)
* Leiningen (Build tool for clojure, located [on github](https://github.com/technomancy/leiningen) 
* ClojureScript
* [cljs-watch](https://github.com/ibdknox/cljs-watch)
* Redis (a really fast key/value store used for caching)

## forma-api

Fire up your command line and:

```bash
git clone git@github.com:whizbangsystems/forma-api.git
cd forma-api
```

## Leiningen

Next install Leiningen, the build tool for Clojure. 

* [Download this script](https://raw.github.com/technomancy/leiningen/stable/bin/lein) which is named `lein`
* Place it on your path so that you can execute it. (I like to use `~/bin`)
* Set it to be executable. (`chmod 755 ~/bin/lein`)

## ClojureScript

Next install ClojureScript. Pick a root directory (`rootdir`) where you want clojureScript to live and run the following commands:

```bash
cd forma-api # from above
sh bootstrap.sh /path/to/rootdir
```

And then just follow the instructions at the end of the install.

## cljs-watch

Next install cljs-watch. This is a small script that watches your source directory for changes to clojureScript files. When it sees a change, it recompiles everything for live updates. Change your source, reload the browser, and you're set! The install is the same as for leiningen, just with a different script:

* [Download the script](https://github.com/ibdknox/cljs-watch/blob/master/cljs-watch) which is named `cljs-watch`.
* Place it on your path. (I like to use `~/bin`)
* Set it to be executable. (`chmod 755 ~/bin/cljs-watch`)

## Redis 

We use [Redis](http://redis.io) as a really fast key-value datastore for caching.

To install Redis 2.2+, You can [download it here](http://redis.io/download) or you can use `brew install redis`.
  
# Usage

Use two terminals. In the first:

```bash
cd forma-api
lein deps
# be sure {redis install location}/src is available in your PATH
redis-server
lein ring server    
```

And in the second:

```bash
cd forma-api
cljs-watch
```

If everything is working, you can access http://127.0.0.1:3000/api/countries and you'll see some JSON:

```json
{
  "period":{
    "year":2012,
    "month":1
  },
  "countries":{
    "indonesia":1,
    "brazil":1,
    "malaysia":1
  }
}
```

# Notes about Redis 

A quick note when developing with Redis. Remember that JSON responses are cached in Redis. If you're seeing strange behavior with JSON values, use the `redis-cli` tool to flush the database:

```bash
redis-cli
redis 127.0.0.1:6379> FLUSHALL
```

You can also use `redis-cli` to inspect keys and values:

```bash
redis-cli
redis 127.0.0.1:6379> get "/api/countries"
"{\"period\":{\"year\":2012,\"month\":1},\"countries\":{\"indonesia\":1,\"brazil\":1,\"malaysia\":1}}"
```
